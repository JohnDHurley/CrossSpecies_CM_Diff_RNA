---
title: "RNA_PCA"
output: html_document
date: "2026-01-22"
---

```{r setup, include=FALSE,warning=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE,
	dev = c("png","pdf")
)
```


```{r Setting_Up_Enviroment, include=FALSE,warning=FALSE}

####Library Loading####
library("edgeR")
library("ggplot2")
library("tibble")
library("dplyr")
library("ggrepel")
library("readr")
library("org.Hs.eg.db")
library("AnnotationDbi")
library("pheatmap")
library("Cormotif")
library("tidyverse")
library("workflowr")
library("RUVSeq")
library("SummarizedExperiment")
library("readxl")
library("ggfortify")
library("ComplexHeatmap")

# BiocManager::install("SummarizedExperiment")

RNA_fc_df <- readRDS("data/Raw_Data/RNA_fc_df.RDS")
RNA_Metadata <- readRDS("data/Raw_Data/RNA_Metadata.RDS")

RNA_fc <- readRDS("data/QC/RNA_fc.RDS")
RNA_log2cpm <- readRDS("data/QC/RNA_log2cpm.RDS")

Filt_RMG0_RNA_fc <- readRDS("data/QC/Filt_RMG0_RNA_fc.RDS")
Filt_RMG0_RNA_log2cpm <- readRDS("data/QC/RNA_log2cpm_RMG0.RDS")

ann_colors <- readRDS("data/QC/ann_colors.RDS")

RNA_Metadata_No4 <- readRDS("data/QC/RNA_Metatdata_No4.RDS")
Filt_RMG0_RNA_fc_NoD4 <- readRDS("data/QC/Filt_RMG0_RNA_fc_NoD4.RDS")
Filt_RMG0_RNA_log2cpm_NoD4 <- readRDS("data/QC/Filt_RMG0_RNA_log2cpm_NoD4.RDS")

ann_colors_No4 <- readRDS("data/QC/ann_colors_no4.RDS")

prcomp_RNA <- readRDS("data/QC/prcomp_RNA.RDS")
prcomp_RNA_meta <- readRDS("data/QC/prcomp_RNA_meta.RDS")
prcomp_Filt_RMG0_RNA <- readRDS("data/QC/prcomp_Filt_RMG0_RNA.RDS")
prcomp_Filt_RMG0_RNA_meta <- readRDS("data/QC/prcomp_Filt_RMG0_RNA_meta.RDS")
prcomp_Filt_RMG0_RNA_log2cpm_NoD4 <- readRDS("data/QC/prcomp_Filt_RMG0_RNA_log2cpm_NoD4.RDS")
prcomp_Filt_RMG0_RNA_log2cpm_NoD4_meta <- readRDS("data/QC/prcomp_Filt_RMG0_RNA_log2cpm_NoD4_meta.RDS")

```

```{r RNA_Unfiltered_PCA_PC1_PC2, fig.height=6,fig.width=8}
prcomp_RNA <- prcomp(t(RNA_log2cpm), scale=FALSE, center = TRUE)
prcomp_RNA_meta <- prcomp_RNA$x %>% cbind(., RNA_Metadata)
#PCA checks
#k=1

prcomp_RNA_meta$Timepoint <- factor(prcomp_RNA_meta$Timepoint, levels = c("Day0","Day2","Day4","Day5","Day15","Day30"))

ggplot2::autoplot(prcomp_RNA,
                  data = prcomp_RNA_meta,
                  colour = "Timepoint",
                  shape = "Species",
                  size = 4,
                  x=1,
                  y=2) +
  scale_color_manual(values=ann_colors$timepoint_cor)+
  ggrepel::geom_text_repel(label = RNA_Metadata$Individual,
                            vjust = -0.5,
                            max.overlaps = 50)+
  ggtitle("PC1 v. PC2
Unfiltered RNA-Seq Log2CPM")

# saveRDS(prcomp_RNA,"data/QC/prcomp_RNA.RDS")
# saveRDS(prcomp_RNA_meta,"data/QC/prcomp_RNA_meta.RDS")

```


```{r RNA_RMG0_PCA_PC1_PC2, fig.height=6,fig.width=8}
prcomp_Filt_RMG0_RNA <- prcomp(t(Filt_RMG0_RNA_log2cpm), scale=FALSE, center = TRUE)
prcomp_Filt_RMG0_RNA_meta <- prcomp_Filt_RMG0_RNA$x %>% cbind(., RNA_Metadata)
#PCA checks
#k=1

prcomp_Filt_RMG0_RNA_meta$Timepoint <- factor(prcomp_Filt_RMG0_RNA_meta$Timepoint, levels = c("Day0","Day2","Day4","Day5","Day15","Day30"))

ggplot2::autoplot(prcomp_Filt_RMG0_RNA ,
                  data = prcomp_Filt_RMG0_RNA_meta,
                  colour = "Timepoint",
                  shape = "Species",
                  size = 4,
                  x=1,
                  y=2) +
  scale_color_manual(values=ann_colors$timepoint_cor)+
  ggrepel::geom_text_repel(label = RNA_Metadata$Individual,
                            vjust = -0.5,
                            max.overlaps = 50)+
  ggtitle("PC1 v. PC2
Filtered RNA-Seq Log2CPM 
Row Means > 0")

# saveRDS(prcomp_Filt_RMG0_RNA,"data/QC/prcomp_Filt_RMG0_RNA.RDS")
# saveRDS(prcomp_Filt_RMG0_RNA_meta,"data/QC/prcomp_Filt_RMG0_RNA_meta.RDS")

```


```{r RNA_NoD4_RMG0_PCA_PC1_PC2, fig.height=6,fig.width=8}

prcomp_Filt_RMG0_RNA_log2cpm_NoD4 <- prcomp(t(Filt_RMG0_RNA_log2cpm_NoD4), scale=FALSE, center = TRUE)
prcomp_Filt_RMG0_RNA_log2cpm_NoD4_meta <- prcomp_Filt_RMG0_RNA_log2cpm_NoD4$x %>% cbind(., RNA_Metadata_No4)
#PCA checks
#k=1

prcomp_Filt_RMG0_RNA_log2cpm_NoD4_meta$Timepoint <- factor(prcomp_Filt_RMG0_RNA_log2cpm_NoD4_meta$Timepoint, levels = c("Day0","Day2","Day5","Day15","Day30"))

ggplot2::autoplot(prcomp_Filt_RMG0_RNA_log2cpm_NoD4 ,
                  data = prcomp_Filt_RMG0_RNA_log2cpm_NoD4_meta,
                  colour = "Timepoint",
                  shape = "Species",
                  size = 4,
                  x=1,
                  y=2) +
  scale_color_manual(values=ann_colors_No4$timepoint_cor)+
  ggrepel::geom_text_repel(label = RNA_Metadata_No4$Individual,
                            vjust = -0.5,
                            max.overlaps = 50)+
  ggtitle("PC1 v. PC2
Filtered RNA-Seq Log2CPM 
No Day 4
Row Means > 0")

# saveRDS(prcomp_Filt_RMG0_RNA_log2cpm_NoD4,"data/QC/prcomp_Filt_RMG0_RNA_log2cpm_NoD4.RDS")
# saveRDS(prcomp_Filt_RMG0_RNA_log2cpm_NoD4_meta,"data/QC/prcomp_Filt_RMG0_RNA_log2cpm_NoD4_meta.RDS")

```

```{r RNA_NoD4_RMG0_PCA_PC3_PC4, fig.height=6,fig.width=8}

prcomp_Filt_RMG0_RNA_log2cpm_NoD4_meta$Timepoint <- factor(prcomp_Filt_RMG0_RNA_log2cpm_NoD4_meta$Timepoint, levels = c("Day0","Day2","Day5","Day15","Day30"))

ggplot2::autoplot(prcomp_Filt_RMG0_RNA_log2cpm_NoD4 ,
                  data = prcomp_Filt_RMG0_RNA_log2cpm_NoD4_meta,
                  colour = "Timepoint",
                  shape = "Species",
                  size = 4,
                  x=3,
                  y=4) +
  scale_color_manual(values=ann_colors_No4$timepoint_cor)+
  ggrepel::geom_text_repel(label = RNA_Metadata_No4$Individual,
                            vjust = -0.5,
                            max.overlaps = 50)+
  ggtitle("PC3 v. PC4
Filtered RNA-Seq Log2CPM 
No Day 4
Row Means > 0")

# saveRDS(prcomp_Filt_RMG0_RNA_log2cpm_NoD4,"data/QC/prcomp_Filt_RMG0_RNA_log2cpm_NoD4.RDS")
# saveRDS(prcomp_Filt_RMG0_RNA_log2cpm_NoD4_meta,"data/QC/prcomp_Filt_RMG0_RNA_log2cpm_NoD4_meta.RDS")

```

```{r Updating Website, eval = FALSE}

# git -> commit all changes
# git -> push
# wflow_publish("analysis/RNA_PCA_Ensemble.Rmd")

```
